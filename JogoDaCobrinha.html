<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Snake</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <button onclick="IniciarJogo()">Play</button>
  <button onclick="PausarJogo()">Pause</button>
  <div class="tabuleiroStyle" id="tabuleiro">
  </div>
</body>

</html>
<script>
  //geral
  var TabuleiroTamanho = 10

  var Jogando = false
  var FimJogo = false

  //dentro do jogo
  var direction = [1,0]
  var lastMove = [1,0]
  var position = [1,0]
  var velocidade = 200
  var corpoCobra = [position]
  var casasVazias = []
  var frutaPos = [2,2]

  //teclas 
  var TeclaCima = ["KeyW" , "ArrowUp"]
  var TeclaBaixo = ["KeyS" , "ArrowDown"]
  var TeclaEsquerda = ["KeyA" , "ArrowLeft"]
  var TeclaDireita = ["KeyD" , "ArrowRight"]
  var TeclaEnter = ["Space" , "Enter"]

  

  for(var y = -TabuleiroTamanho; y <= TabuleiroTamanho; y++){ //criando o tabuleiro
    for(var x = -TabuleiroTamanho; x <= TabuleiroTamanho; x++){
      tabuleiro.innerHTML += `<div class="campo" style="width:${500/(TabuleiroTamanho*2+1)}px; height:${500/(TabuleiroTamanho*2+1)}px" id="campo_n${x}&${y}"></div>`
      //tabuleiro.innerHTML += `<div class="campo" style="width:${500/(TabuleiroTamanho*2+1)}px; height:${500/(TabuleiroTamanho*2+1)}px" id="campo_n${x}&${y}">${x}&${y}</div>`
    }
  }

  function IniciarJogo() {
    if(!Jogando){
      setTimeout(frame, 400)
      Jogando = true
      
    }

  }


  function PausarJogo(){
    Jogando = false
  }

  window.addEventListener('keydown', event => {
    if (TeclaCima.includes(event.code) && lastMove[1] != 1){
      direction = [0, -1]
    }
    if (TeclaBaixo.includes(event.code) && lastMove[1] != -1){
      direction = [0, 1]
    }
    if (TeclaEsquerda.includes(event.code) && lastMove[0] != 1){
      direction = [-1, 0]
    }
    if (TeclaDireita.includes(event.code) && lastMove[0] != -1){
      direction = [1, 0]
    }
    if(TeclaEnter.includes(event.code)){
      console.log("enter")
    }
  });

  function frame(){
    
    position[0] += direction[0]
    position[1] += direction[1]
    DefinirCasasVazias()
    lastMove = direction

    var newPos = [position[0],position[1]]
    corpoCobra.push(newPos) //adicionando nova posição ao corpo

    if(position[0] == frutaPos[0] && position[1] == frutaPos[1]){
      GerarFruta();
    }else{
      corpoCobra.shift() // tirando ultima posição
    }

    if(!EstaEmCasaVazia()){
      console.log(corpoCobra.length + " pontos. Parabéns!")
      Jogando = false
      position = [0,0]
      corpoCobra = [position]
      direction = [1,0]
      lastMove = [1,0]
      GerarFruta()
    }else{
      PintarFrames()
      if(Jogando){
        setTimeout(frame, velocidade)
      }
    }
  }

  function EstaEmCasaVazia(){
    var colision = false
    for(var i = 0; i < casasVazias.length; i++){
      var casaPos = []
      casaPos[0] =  casasVazias[i][0]
      casaPos[1] =  casasVazias[i][1]

      if(position[0] == casaPos[0] && position[1] == casaPos[1]){
        colision = true
      }
    }
    return colision 
  }

  function DefinirCasasVazias(){
    casasVazias = []
    
    for (var x = -TabuleiroTamanho; x <= TabuleiroTamanho; x++) { //pegar todas as bordas
      for (var y = -TabuleiroTamanho; y <= TabuleiroTamanho; y++) { //pegar todas as bordas
        var atualPos = []
        atualPos[0] = x
        atualPos[1] = y
        var podeAdicionar = true
        for(var i = 1; i<corpoCobra.length; i++){ //posições do corpo da cobra
          var atualCorpoPos = corpoCobra[i]
          
          if(atualCorpoPos[0] == atualPos[0] && atualCorpoPos[1] == atualPos[1]){
            podeAdicionar = false
            i = corpoCobra.length
          }
        }
        if(podeAdicionar){
          casasVazias.push(atualPos)
        }
      }
    }
    //ideia** definicar casas vazias adicionando e tirando casas as casas do corpo da cobra

  }


  function PintarFrames(){
    for (var x = -TabuleiroTamanho; x <= TabuleiroTamanho; x++) { //deixa tudo branco
      for (var y = -TabuleiroTamanho; y <= TabuleiroTamanho; y++) {
        document.getElementById("campo_n" + x.toString() +"&"+ y.toString()).style.backgroundColor = "black";
      }
    }

    document.getElementById("campo_n" + frutaPos[0].toString() +"&"+ frutaPos[1].toString()).style.backgroundColor = "#FF00FF";
    
    for(var i = 0; i<corpoCobra.length; i++){ //pinta o corpo da cobra
      var atualCorpoPos = corpoCobra[i]
      if(atualCorpoPos[0] >= -TabuleiroTamanho && atualCorpoPos[1] >= -TabuleiroTamanho && atualCorpoPos[0] <= TabuleiroTamanho && atualCorpoPos[1] <= TabuleiroTamanho){

 
        document.getElementById("campo_n" + atualCorpoPos[0].toString() +"&"+ atualCorpoPos[1].toString()).style.backgroundColor = `#EEEEEE`;;

        
      }
    }
    //document.getElementById("campo_n" + position[0].toString() +"&"+ position[1].toString()).style.backgroundColor = "red"; // cabeça da cobra
  }

  function GerarFruta(){
    var frutaIndex = getRandomInt(0,casasVazias.length-1)
    frutaPos = casasVazias[frutaIndex]
    console.log(frutaPos)
  }

  function getRandomInt(min, max) {
    min = Math.ceil(min);
    max = Math.floor(max);
    return Math.floor(Math.random() * (max - min)) + min;
  } 
</script>
