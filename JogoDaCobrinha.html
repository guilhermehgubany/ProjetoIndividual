<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Snake</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <button onclick="IniciarJogo()">Play</button>
  <button onclick="PausarJogo()">Pause</button>
  <div class="tabuleiroStyle" id="tabuleiro">
  </div>
</body>

</html>
<script>
  //geral
  var TabuleiroTamanho = 10

  var Jogando = false
  var FimJogo = false;

  //dentro do jogo
  var direction = [1,0]
  var lastMove = [1,0]
  var position = [1,0]
  var corpoCobra = [position]
  var muros = []
  var frutaPos = [2,2]

  //teclas
  var TeclaCima = ["KeyW"]
  var TeclaBaixo = ["KeyS"]
  var TeclaEsquerda = ["KeyA"]
  var TeclaDireita = ["KeyD"]

  

  for(var y = 0; y < TabuleiroTamanho; y++){ //criando o tabuleiro
    for(var x = 0; x < TabuleiroTamanho; x++){
      tabuleiro.innerHTML += `<div class="campo" style="width:${500/TabuleiroTamanho}px; height:${500/TabuleiroTamanho}px" id="campo_n${x.toString() + y.toString()}"></button>`
    }
  }

  function IniciarJogo() {
    if(!Jogando){
      setTimeout(frame, 400)
      Jogando = true
    }

  }

  function PausarJogo(){
    Jogando = false
  }

  window.addEventListener('keypress', event => {
    if (TeclaCima.includes(event.code) && lastMove[1] != 1){
      direction = [0, -1]
    }
    if (TeclaBaixo.includes(event.code) && lastMove[1] != -1){
      direction = [0, 1]
    }
    if (TeclaEsquerda.includes(event.code) && lastMove[0] != 1){
      direction = [-1, 0]
    }
    if (TeclaDireita.includes(event.code) && lastMove[0] != -1){
      direction = [1, 0]
    }
  });

  function frame(){
    
    position[0] += direction[0]
    position[1] += direction[1]
    DefinirMuros()
    lastMove = direction

    var newPos = [position[0],position[1]]
    corpoCobra.push(newPos) //adicionando nova posição ao corpo

    if(position[0] == frutaPos[0] && position[1] == frutaPos[1]){
      GerarFruta();
    }else{
      corpoCobra.shift() // tirando ultima posição
    }

    if(colidindo()){
      Jogando = false
      position = [0,0]
      corpoCobra = [position]
      direction = [1,0]
      lastMove = [1,0]
      GerarFruta()
    }else{
      PintarFrames()
      if(Jogando){
        setTimeout(frame, 400)
      }
    }
    
    
  }
  function colidindo(){
    for(var i = 0; i < muros.length; i++){
      var muroPos = []
      muroPos[0] =  muros[i][0]
      muroPos[1] =  muros[i][1]

      if(position[0] == muroPos[0] && position[1] == muroPos[1]){
        return true
      }
    }
    return false
    
  }
  function DefinirMuros(){
    muros = []
    for (var x = -1; x <= TabuleiroTamanho; x++) { //pegar todas as bordas
      for (var y = -1; y <= TabuleiroTamanho; y++) { //pegar todas as bordas
        if(x < 0 || x >=TabuleiroTamanho || y < 0 || y >= TabuleiroTamanho){
          var muroPos = []
          muroPos[0] = x
          muroPos[1] = y

          muros.push(muroPos)
        }
      }
    }
    for(var i = 0; i<corpoCobra.length-1; i++){ //posições do corpo da cobra
      var atualCorpoPos = corpoCobra[i]
      muros.push(atualCorpoPos)
    }
   
  }

  function PintarFrames(){
    for (var x = 0; x < TabuleiroTamanho; x++) { //deixa tudo branco
      for (var y = 0; y < TabuleiroTamanho; y++) {
        document.getElementById("campo_n" + x.toString() + y.toString()).style.backgroundColor = "black";
      }
    }

    document.getElementById("campo_n" + frutaPos[0].toString() + frutaPos[1].toString()).style.backgroundColor = "red";
    
    for(var i = 0; i<corpoCobra.length; i++){ //pinta o corpo da cobra
      var atualCorpoPos = corpoCobra[i]
      if(atualCorpoPos[0] >= 0 && atualCorpoPos[1] >= 0 && atualCorpoPos[0] < TabuleiroTamanho && atualCorpoPos[1] < TabuleiroTamanho){
        document.getElementById("campo_n" + atualCorpoPos[0].toString() + atualCorpoPos[1].toString()).style.backgroundColor = "green";
      }
    }
    //document.getElementById("campo_n" + position[0].toString() + position[1].toString()).style.backgroundColor = "red"; // cabeça da cobra
  }

  function GerarFruta(){
    var frutax = getRandomInt(0,TabuleiroTamanho-1)
    var frutay = getRandomInt(0,TabuleiroTamanho-1)

    var corpox = []
    var corpoy = []
    
    for(var i = 0; i<corpoCobra.length; i++){ //posições do corpo da cobra
      var atualCorpoPos = corpoCobra[i]

      corpox.push(atualCorpoPos[0])
      corpoy.push(atualCorpoPos[1])
    }

    while(corpox.includes(frutax) && corpoy.includes(frutay)){
      frutax = getRandomInt(0,TabuleiroTamanho-1)
      frutay = getRandomInt(0,TabuleiroTamanho-1)
    }

    frutaPos = [frutax,frutay]
  }

  function getRandomInt(min, max) {
    min = Math.ceil(min);
    max = Math.floor(max);
    return Math.floor(Math.random() * (max - min)) + min;
  } 
</script>
y